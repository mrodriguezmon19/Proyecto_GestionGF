@model Proyecto_GestionGF.Models.Solicitud
@{
    ViewData["Title"] = "Nuevo permiso - Gestión GF";
    // var idUsuarioSesion = Context.Session.GetInt32("IdUsuario") ?? 0;
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"]</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="~/css/site.css" />
</head>
<body class="gf-dashboard-body">

    <!-- HEADER -->
    <header class="gf-header">
        <div class="gf-header-top">
            <div class="gf-logo-wrapper">
                <img src="@Url.Content("~/img/logoGF.png")" alt="Logo Grupo Fiesler" width="100" class="gf-logo-img" />
            </div>
        </div>
        <div class="gf-header-bar">
            <span class="gf-header-bar-text">Calidad y servicio que marcan la diferencia</span>
        </div>
    </header>

    <div class="gf-main-layout">
        <!-- SIDEBAR USUARIO -->
        <aside class="gf-sidebar">
            <div class="gf-sidebar-title">Gestión GF</div>
            <nav class="gf-nav">
                <ul class="gf-nav-list">
                    <li><a class="gf-nav-link gf-nav-link-active" asp-controller="Home" asp-action="MainUsuario">Mi panel</a></li>
                    <li><a class="gf-nav-link" asp-controller="Solicitud" asp-action="CrearSolicitud">Nueva solicitud</a></li>
                    <li><a class="gf-nav-link" asp-controller="Solicitud" asp-action="MisSolicitudes">Mis solicitudes</a></li>
                    <li><a class="gf-nav-link" asp-controller="Home" asp-action="Index">Cerrar sesión</a></li>
                </ul>
            </nav>
        </aside>

        <!-- CONTENIDO -->
        <main class="gf-content">
            <div class="gf-content-header">
                <div>
                    <h1 class="gf-page-title">Nuevo permiso</h1>
                    <p class="gf-page-subtitle">Registre una nueva solicitud de permiso.</p>
                </div>
                <div class="gf-user-info">
                    <a asp-controller="Login" asp-action="CerrarSesion" class="gf-link gf-link-logout">Cerrar sesión</a>
                </div>
            </div>

            <section class="gf-form-card">
                <form asp-action="CrearSolicitud" asp-controller="Solicitud" method="post" enctype="multipart/form-data" class="gf-login-form">
                    @Html.AntiForgeryToken()

                    <div asp-validation-summary="ModelOnly" class="gf-alert gf-alert-error"></div>

                    <!-- IdUsuario oculto (lo trae el controlador desde la sesión) -->
                    <input type="hidden" asp-for="IdUsuario" value="@(ViewBag.IdUsuario ?? 0)" />
                    @* Alternativa:
                    <input type="hidden" asp-for="IdUsuario" value="@(Context.Session.GetInt32("IdUsuario") ?? 0)" />
                    *@

                    <div class="gf-form-section">
                        <h2 class="gf-form-section-title">Datos del permiso</h2>
                        <div class="gf-form-grid-2">

                            <!-- Dropdown de Tipo de Permiso -->
                            <div class="gf-form-group">
                                <label class="gf-label" asp-for="IdTipoPermiso">Tipo de permiso</label>
                                <select asp-for="IdTipoPermiso"
                                        asp-items="@(ViewBag.TiposPermiso as IEnumerable<SelectListItem>)"
                                        class="gf-input">
                                    <option value="">-- Seleccione un tipo --</option>
                                </select>
                                <span asp-validation-for="IdTipoPermiso" class="text-danger"></span>
                            </div>

                            <div class="gf-form-group">
                                <label class="gf-label" asp-for="FechaInicio">Fecha inicio</label>
                                <input asp-for="FechaInicio" type="date" class="gf-input" />
                                <span asp-validation-for="FechaInicio" class="text-danger"></span>
                            </div>

                            <div class="gf-form-group">
                                <label class="gf-label" asp-for="FechaFinal">Fecha fin</label>
                                <input asp-for="FechaFinal" type="date" class="gf-input" />
                                <span asp-validation-for="FechaFinal" class="text-danger"></span>
                            </div>

                            <div class="gf-form-group gf-form-group-full">
                                <label class="gf-label" asp-for="Motivo">Motivo</label>
                                <textarea asp-for="Motivo" class="gf-textarea" rows="3" placeholder="Describa el motivo..."></textarea>
                                <span asp-validation-for="Motivo" class="text-danger"></span>
                            </div>

                            <div class="gf-form-group gf-form-group-full">
                                <label class="gf-label" asp-for="ArchivoFile">Adjuntar documento</label>
                                <!--<input asp-for="ArchivoFile" type="file" class="gf-input" /> -->
                                <input type="file" name="ArchivoAdjunto" class="gf-input" accept=".pdf,.png,.jpg,.jpeg" />
                                <span asp-validation-for="ArchivoFile" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="gf-form-actions">
                        <a asp-action="MainUsuario" asp-controller="Home" class="gf-btn gf-btn-secondary">Cancelar</a>
                        <button type="submit" class="gf-btn gf-btn-primary">Enviar solicitud</button>
                    </div>
                </form>

                @if (ViewBag.Ok != null)
                {
                    if ((bool)ViewBag.Ok)
                    {
                        <div class="gf-alert gf-alert-success">@ViewBag.Mensaje</div>
                    }
                    else
                    {
                        <div class="gf-alert gf-alert-error">@ViewBag.Mensaje</div>
                    }
                }
            </section>
        </main>
    </div>

    <footer class="gf-footer">
        <span>© @DateTime.Now.Year Grupo Fiesler | Gestión GF</span>
    </footer>

    <partial name="_ValidationScriptsPartial" />
</body>
</html>


